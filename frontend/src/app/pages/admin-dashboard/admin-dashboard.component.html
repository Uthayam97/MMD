<div class="container py-4">
  <h2 class="mb-3">Admin Dashboard</h2>
  <div class="row g-4">
    <div class="col-lg-5">
      <div class="card shadow-sm">
        <div class="card-header">
          {{ editingId ? "Edit Product" : "Add Product" }}
        </div>
        <form class="card-body" #productFormRef="ngForm" (ngSubmit)="saveProduct()" novalidate>
          <div class="mb-2">
            <label class="form-label">Name</label
            ><input
              class="form-control"
              name="name"
              required
              minlength="2"
              #nameRef="ngModel"
              [(ngModel)]="productForm.name"
            />
            <small class="text-danger" *ngIf="(submitted || nameRef.touched) && nameRef.invalid">
              Enter a valid name (minimum 2 characters).
            </small>
          </div>
          <div class="mb-2">
            <label class="form-label">Description</label
            ><textarea
              class="form-control"
              name="description"
              required
              minlength="5"
              #descriptionRef="ngModel"
              rows="2"
              [(ngModel)]="productForm.description"
            ></textarea>
            <small class="text-danger" *ngIf="(submitted || descriptionRef.touched) && descriptionRef.invalid">
              Enter a valid description (minimum 5 characters).
            </small>
          </div>
          <div class="mb-2">
            <label class="form-label">Image URL</label
            ><input
              class="form-control"
              name="image"
              placeholder="https://example.com/product-image.jpg"
              [(ngModel)]="productForm.image"
            />
            <small class="text-danger" *ngIf="submitted && !productForm.image">
              Provide an image URL or choose an image file.
            </small>
          </div>
          <div class="mb-2">
            <label class="form-label">Or Choose Image File</label
            ><input
              class="form-control"
              type="file"
              accept="image/*"
              (change)="onImageFileSelected($event)"
            />
            <small class="text-muted" *ngIf="selectedImageName">
              Selected: {{ selectedImageName }}
            </small>
            <small class="d-block text-danger" *ngIf="fileError">{{ fileError }}</small>
          </div>
          <div class="row g-2">
            <div class="col">
              <label class="form-label">Price</label
              ><input
                class="form-control"
                name="price"
                type="number"
                min="0.01"
                step="0.01"
                required
                #priceRef="ngModel"
                [(ngModel)]="productForm.price"
              />
              <small class="text-danger" *ngIf="(submitted || priceRef.touched) && priceRef.invalid">
                Enter a valid price greater than 0.
              </small>
            </div>
            <div class="col">
              <label class="form-label">Stock</label
              ><input
                class="form-control"
                name="stock"
                type="number"
                min="0"
                step="1"
                required
                #stockRef="ngModel"
                [(ngModel)]="productForm.stock"
              />
              <small class="text-danger" *ngIf="(submitted || stockRef.touched) && stockRef.invalid">
                Enter a valid stock number (0 or more).
              </small>
            </div>
          </div>
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary" type="submit">
              {{ editingId ? "Update" : "Create" }}</button
            ><button class="btn btn-outline-secondary" type="button" (click)="resetForm()">
              Reset
            </button>
          </div>
        </form>
      </div>
    </div>
    <div class="col-lg-7">
      <div class="card shadow-sm mb-4">
        <div class="card-header">All Products</div>
        <div class="table-responsive">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Stock</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of products">
                <td>{{ product.name }}</td>
                <td>{{ product.price | currency: "USD" }}</td>
                <td>{{ product.stock || 0 }}</td>
                <td class="text-end">
                  <button
                    class="btn btn-outline-primary btn-sm me-2"
                    (click)="editProduct(product)"
                  >
                    Edit</button
                  ><button
                    class="btn btn-outline-danger btn-sm"
                    (click)="deleteProduct(product._id)"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-header">Registered Users</div>
        <div class="table-responsive">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users">
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>
                  <span
                    class="badge"
                    [class.bg-primary]="user.role === 'admin'"
                    [class.bg-secondary]="user.role !== 'admin'"
                    >{{ user.role }}</span
                  >
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
