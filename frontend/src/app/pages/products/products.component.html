<div class="container py-4">
  <div
    class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3"
  >
    <h2 class="mb-0">Products</h2>
    <input
      type="text"
      class="form-control w-auto"
      style="min-width: 280px"
      placeholder="Search products"
      [(ngModel)]="searchTerm"
    />
  </div>
  <div *ngIf="loading" class="alert alert-info">Loading products...</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
  <div class="row g-4" *ngIf="!loading">
    <div class="col-sm-6 col-lg-4" *ngFor="let product of filteredProducts">
      <div class="card h-100 shadow-sm">
        <div class="card-header fw-semibold">{{ product.name }}</div>
        <img
          [src]="product.image"
          class="card-img-top product-image"
          [alt]="product.name"
        />
        <div class="card-body">
          <p class="card-text text-muted mb-0">
            {{ product.description || "Quality product from our store." }}
          </p>
        </div>
        <div
          class="card-footer d-flex justify-content-between align-items-center"
        >
          <div>
            <span class="fw-bold text-primary">{{ product.price | currency: "USD" }}</span>
            <div class="small mt-1" [class.text-danger]="!canBuy(product)" [class.text-success]="canBuy(product)">
              {{ canBuy(product) ? ("In Stock: " + (product.stock || 0)) : "Out of Stock" }}
            </div>
          </div>
          <button class="btn btn-sm" [class.btn-success]="canBuy(product)" [class.btn-secondary]="!canBuy(product)" [disabled]="!canBuy(product)" (click)="addToCart(product)">
            {{ canBuy(product) ? "Buy Now" : "Out of Stock" }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
